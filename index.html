<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title></title>
    <style>
        .on{color: blue;}
    </style>
</head>
<body>
<p id="p" class="on">무궁화꽃이피었습니다</p>
<button id="btn">버튼</button>
<ul>
    <li class="li">1</li>
    <li class="li">2</li>
    <li class="li">3</li>
    <li class="li">4</li>
    <li class="li">5</li>
    <li class="li">6</li>
</ul>
<script>
    var $ = (function(){
        function $(selector) {
            if(typeof selector === 'object'){
                this.selector = selector;
            }else {
                if(selector.indexOf('.') > -1) {
                    //class
                    this.selector = document.getElementsByClassName(selector.substr(1));
                }else if(selector.indexOf('#') > -1){
                    this.selector = document.getElementById(selector.substr(1));
                }else{
                    //tag || null
                }
            }
        }
        var showedLayer = null;

        $.prototype = {
            addClass : function(className) {
                var i;
                if(this.selector.constructor.name === 'HTMLCollection') {
                    i = this.selector.length;
                    while(i--) {
                        this.selector[i].classList.add(className);
                    }
                }else {
                    this.selector.classList.add(className);
                }
                return this;
            },
            removeClass : function(className) {
                var i;
                if(this.selector.constructor.name === 'HTMLCollection') {
                    i = this.selector.length;
                    while(i--) {
                        this.selector[i].classList.remove(className);
                    }
                }else {
                    this.selector.classList.remove(className);
                }
                return this;
            },
            css : function(style) {
                for(var i in style){
                    this.selector.style[i.replace(/([a-z])([A-Z])/g, '$1-$2').toLowerCase()] = style[i];
                }
                return this;
            },
            on : function(type, handler) {
                var i;
                if(this.selector.constructor.name === 'HTMLCollection') {
                    i = this.selector.length;
                    while(i--) {
                        this.selector[i].addEventListener(type, handler);
                    }
                }else {
                    this.selector.addEventListener(type, handler);
                }
                return this;
            },
            toggleClass : function(className) {
                if(this.selector.classList.contains(className)) {
                    this.selector.classList.remove(className);
                }else {
                    this.selector.classList.add(className);
                }
                return this;
            },
            showLayer : function(filePath, pos, callback) {

                var location = window.location.href.lastIndexOf('/');
                var url =  window.location.href.substr(0, location) + '/' + filePath;
                if(showedLayer){
                    return;
                }
                factory.ajax(url, function(res){
                    var layer = document.createElement('div');
                    layer.style.position = 'absolute';
                    layer.style.left = pos.x;
                    layer.style.top = pos.y;

                    layer.style.border = '1px solid rgb(219, 218, 218)';
                    layer.style['box-shadow']='0 7px 8px -4px rgba(0,0,0,.2),0 13px 19px 2px rgba(0,0,0,.14),0 5px 24px 4px rgba(0,0,0,.12)';

                    layer.innerHTML = res;
                    document.body.appendChild(layer);

                    showedLayer = layer;

                    callback();
                });
            },
            hideLayer : function() {
                document.body.removeChild(showedLayer);
                showedLayer = null;
            },
            attr : function(k, v) {
                if(v) {

                    console.log(this.selector.attributes);
                }
            }
        };
        function factory(id) {
            return new $(id);
        }
        factory.ajax = function(url, success, fail) {
            var xhr = new XMLHttpRequest();

            xhr.open('get', url, true);

            xhr.onreadystatechange = function(ev) {
                if(xhr.readyState === 4) {
                    if(xhr.status === 200) {
                        success(xhr.responseText);
                    } else {
                        fail('Error');
                    }
                }
            };
            xhr.onprogress = function(e) {
                //console.log(e);
            };
            xhr.send(null);
        };
        return factory;
    }());






    $('#p').addClass('on').css({
        width : '200px',
        height: '200px',
        backgroundColor: 'yellow'
    }).on('click', function(e) {
        $(this).toggleClass('on');
    });

    $('.li').addClass('on').on('click', function(e) {
        $(this).css({color: 'red'});
    });

    $.ajax('friends.json', function(res) {
        console.info(res);
    }, function(err) {
        console.error(err);
    });

    $('#btn').on('click', function() {
        var self = this;
        $(this).showLayer('layer.html', {x : '200px', y : '300px'}, function() {
            setTimeout(function() {
                $(self).hideLayer();
            }, 1000);
        });
    });

    $('#btn').attr('id',2);


</script>

</body>
</html>
